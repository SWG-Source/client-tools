// ======================================================================
//
// tatooine_tosche_sorna.script
// Copyright 2004, Sony Online Entertainment
// All Rights Reserved.
//
// Created with SwgConversationEditor 1.36 - DO NOT EDIT THIS AUTO-GENERATED FILE!
//
// ======================================================================

// ======================================================================
// Library Includes
// ======================================================================

include library.ai_lib;
include library.chat;
include library.groundquests;
include library.utils;

// ======================================================================
// Script Constants
// ======================================================================

string c_stringFile = "conversation/tatooine_tosche_sorna";

// ======================================================================
// Script Conditions
// ======================================================================

boolean tatooine_tosche_sorna_condition__defaultCondition (obj_id player, obj_id npc)
{
	return true;
}

// ----------------------------------------------------------------------

boolean tatooine_tosche_sorna_condition_completedFlowers (obj_id player, obj_id npc)
{
	return (groundquests.hasCompletedQuest(player, "tatooine_tosche_shmi_flowers") ||
		   groundquests.hasCompletedQuest(player, "tatooine_tosche_shmi_flowers_side"));
}

// ----------------------------------------------------------------------

boolean tatooine_tosche_sorna_condition_onPlaceFlowers (obj_id player, obj_id npc)
{
	return (groundquests.isTaskActive(player, "tatooine_tosche_shmi_flowers_side", "tat_tosche_nessa_e2s") ||
			groundquests.isTaskActive(player, "tatooine_tosche_shmi_flowers", "tat_tosche_nessa_e2"));
}

// ----------------------------------------------------------------------

boolean tatooine_tosche_sorna_condition_onTalkSorna (obj_id player, obj_id npc)
{
	return (groundquests.isTaskActive(player, "tatooine_tosche_goto_sorna", "tat_tosche_sorna_e1") ||
			groundquests.isTaskActive(player, "tatooine_tosche_shmi_flowers", "tat_tosche_nessa_e1"));
}

// ======================================================================
// Script Actions
// ======================================================================

void tatooine_tosche_sorna_action_grantFlowers (obj_id player, obj_id npc)
{
	groundquests.grantQuest(player, "tatooine_tosche_shmi_flowers_side");
}

// ----------------------------------------------------------------------

void tatooine_tosche_sorna_action_signalFlowers (obj_id player, obj_id npc)
{
	groundquests.sendSignal(player, "tat_tosche_nessa_e1");
}

// ======================================================================
// Script %TO Tokens
// ======================================================================

// ======================================================================
// Script %DI Tokens
// ======================================================================

// ======================================================================
// Script %DF Tokens
// ======================================================================

// ======================================================================
// handleBranch<n> Functions 
// ======================================================================

int tatooine_tosche_sorna_handleBranch1 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: You are very kind to indulge an old lady's whim.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: My pleasure, Sorna.
	if (response == "s_6")
	{
		//-- [NOTE] 
		if (tatooine_tosche_sorna_condition__defaultCondition (player, npc))
		{
			//-- NPC: You're a nice person.
			string_id message = new string_id (c_stringFile, "s_15");
			utils.removeScriptVar (player, "conversation.tatooine_tosche_sorna.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int tatooine_tosche_sorna_handleBranch3 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Were you able to place those flowers?

	//-- [RESPONSE NOTE] 
	//-- PLAYER: No Ma'am.
	if (response == "s_29")
	{
		//-- [NOTE] 
		if (tatooine_tosche_sorna_condition__defaultCondition (player, npc))
		{
			//-- NPC: That's ok dear. I know you're busy.
			string_id message = new string_id (c_stringFile, "s_31");
			utils.removeScriptVar (player, "conversation.tatooine_tosche_sorna.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int tatooine_tosche_sorna_handleBranch5 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Excuse me, please. I was wondering if you wouldn't mind helping me with a small matter I need to have attended to?

	//-- [RESPONSE NOTE] 
	//-- PLAYER: What can I do for you?
	if (response == "s_22")
	{
		tatooine_tosche_sorna_action_signalFlowers (player, npc);

		//-- [NOTE] 
		if (tatooine_tosche_sorna_condition__defaultCondition (player, npc))
		{
			//-- NPC: An old friend of mine died a while back and I have placed flowers on her grave this time every year. I've tried several times to make it out there this year but something always seems to happen. Could you place these flowers on her grave?
			string_id message = new string_id (c_stringFile, "s_24");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: Yes, I can do that.
			boolean hasResponse0 = false;
			if (tatooine_tosche_sorna_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_26");

				utils.setScriptVar (player, "conversation.tatooine_tosche_sorna.branchId", 6);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.tatooine_tosche_sorna.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int tatooine_tosche_sorna_handleBranch6 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: An old friend of mine died a while back and I have placed flowers on her grave this time every year. I've tried several times to make it out there this year but something always seems to happen. Could you place these flowers on her grave?

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Yes, I can do that.
	if (response == "s_26")
	{
		//-- [NOTE] 
		if (tatooine_tosche_sorna_condition__defaultCondition (player, npc))
		{
			tatooine_tosche_sorna_action_grantFlowers (player, npc);

			//-- NPC: Oh, thank you! Look for the headstone marked Shmi. Place the flowers there.
			string_id message = new string_id (c_stringFile, "s_28");
			utils.removeScriptVar (player, "conversation.tatooine_tosche_sorna.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int tatooine_tosche_sorna_handleBranch8 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Oh dear, I'll never make it out that far this time.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Can I help?
	if (response == "s_32")
	{
		//-- [NOTE] 
		if (tatooine_tosche_sorna_condition__defaultCondition (player, npc))
		{
			//-- NPC: Oh, would you? I have placed flowers on the gravesite of a good friend every year. I've tried several times already this year and I always seem to get turned back. Could you please take these flowers to the gravestone marked Shmi at the old Lars' homestead?
			string_id message = new string_id (c_stringFile, "s_34");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: I can do that for you.
			boolean hasResponse0 = false;
			if (tatooine_tosche_sorna_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_36");

				utils.setScriptVar (player, "conversation.tatooine_tosche_sorna.branchId", 9);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.tatooine_tosche_sorna.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Sorry, but I am too busy to help you right now.
	if (response == "s_44")
	{
		//-- [NOTE] 
		if (tatooine_tosche_sorna_condition__defaultCondition (player, npc))
		{
			//-- NPC: I understand.
			string_id message = new string_id (c_stringFile, "s_46");
			utils.removeScriptVar (player, "conversation.tatooine_tosche_sorna.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int tatooine_tosche_sorna_handleBranch9 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Oh, would you? I have placed flowers on the gravesite of a good friend every year. I've tried several times already this year and I always seem to get turned back. Could you please take these flowers to the gravestone marked Shmi at the old Lars' homestead?

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I can do that for you.
	if (response == "s_36")
	{
		tatooine_tosche_sorna_action_grantFlowers (player, npc);

		//-- [NOTE] 
		if (tatooine_tosche_sorna_condition__defaultCondition (player, npc))
		{
			//-- NPC: Please be careful I don't want you to get hurt helping me.
			string_id message = new string_id (c_stringFile, "s_38");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: I'll be fine, don't you worry about me.
			boolean hasResponse0 = false;
			if (tatooine_tosche_sorna_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_40");

				utils.setScriptVar (player, "conversation.tatooine_tosche_sorna.branchId", 10);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.tatooine_tosche_sorna.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int tatooine_tosche_sorna_handleBranch10 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Please be careful I don't want you to get hurt helping me.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I'll be fine, don't you worry about me.
	if (response == "s_40")
	{
		//-- [NOTE] 
		if (tatooine_tosche_sorna_condition__defaultCondition (player, npc))
		{
			//-- NPC: Thank you so much!
			string_id message = new string_id (c_stringFile, "s_42");
			utils.removeScriptVar (player, "conversation.tatooine_tosche_sorna.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

// ======================================================================
// User Script Triggers
// ======================================================================

trigger OnInitialize ()
{
	if ((!isTangible (self)) || (isPlayer (self)))
		detachScript(self, "conversation.tatooine_tosche_sorna");

	setCondition (self, CONDITION_CONVERSABLE);

	return SCRIPT_CONTINUE;
}

trigger OnAttach ()
{
	setCondition (self, CONDITION_CONVERSABLE);

	return SCRIPT_CONTINUE;
}

trigger OnObjectMenuRequest (obj_id player, menu_info menuInfo)
{
	int menu = menuInfo.addRootMenu (menu_info_types.CONVERSE_START, null);
	menu_info_data menuInfoData = menuInfo.getMenuItemById (menu);
	menuInfoData.setServerNotify (false);
	setCondition (self, CONDITION_CONVERSABLE);

	return SCRIPT_CONTINUE;
}

trigger OnIncapacitated (obj_id killer)
{
	clearCondition (self, CONDITION_CONVERSABLE);
	detachScript (self, "conversation.tatooine_tosche_sorna");

	return SCRIPT_CONTINUE;
}

// ======================================================================
// Script Triggers
// ======================================================================

//-- This function should move to base_class.java
boolean npcStartConversation(obj_id player, obj_id npc, string convoName, string_id greetingId, prose_package greetingProse, string_id[] responses)
{
	Object[] objects = new Object[responses.length];
	System.arraycopy(responses, 0, objects, 0, responses.length);
	return npcStartConversation(player, npc, convoName, greetingId, greetingProse, objects);
}

// ----------------------------------------------------------------------

trigger OnStartNpcConversation (obj_id player)
{
	obj_id npc = self;

	if (ai_lib.isInCombat (npc) || ai_lib.isInCombat (player))
		return SCRIPT_OVERRIDE;

	//-- [NOTE] 
	if (tatooine_tosche_sorna_condition_completedFlowers (player, npc))
	{
		//-- NPC: You are very kind to indulge an old lady's whim.
		string_id message = new string_id (c_stringFile, "s_4");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: My pleasure, Sorna.
		boolean hasResponse0 = false;
		if (tatooine_tosche_sorna_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_6");

			utils.setScriptVar (player, "conversation.tatooine_tosche_sorna.branchId", 1);

			npcStartConversation (player, npc, "tatooine_tosche_sorna", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (tatooine_tosche_sorna_condition_onPlaceFlowers (player, npc))
	{
		//-- NPC: Were you able to place those flowers?
		string_id message = new string_id (c_stringFile, "s_27");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: No Ma'am.
		boolean hasResponse0 = false;
		if (tatooine_tosche_sorna_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_29");

			utils.setScriptVar (player, "conversation.tatooine_tosche_sorna.branchId", 3);

			npcStartConversation (player, npc, "tatooine_tosche_sorna", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (tatooine_tosche_sorna_condition_onTalkSorna (player, npc))
	{
		//-- NPC: Excuse me, please. I was wondering if you wouldn't mind helping me with a small matter I need to have attended to?
		string_id message = new string_id (c_stringFile, "s_20");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: What can I do for you?
		boolean hasResponse0 = false;
		if (tatooine_tosche_sorna_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_22");

			utils.setScriptVar (player, "conversation.tatooine_tosche_sorna.branchId", 5);

			npcStartConversation (player, npc, "tatooine_tosche_sorna", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (tatooine_tosche_sorna_condition__defaultCondition (player, npc))
	{
		//-- NPC: Oh dear, I'll never make it out that far this time.
		string_id message = new string_id (c_stringFile, "s_30");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: Can I help?
		boolean hasResponse0 = false;
		if (tatooine_tosche_sorna_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		//-- PLAYER: Sorry, but I am too busy to help you right now.
		boolean hasResponse1 = false;
		if (tatooine_tosche_sorna_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse1 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_32");

			if (hasResponse1)
				responses [responseIndex++] = new string_id (c_stringFile, "s_44");

			utils.setScriptVar (player, "conversation.tatooine_tosche_sorna.branchId", 8);

			npcStartConversation (player, npc, "tatooine_tosche_sorna", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	chat.chat (npc, "Error:  All conditions for OnStartNpcConversation were false.");

	return SCRIPT_CONTINUE;
}

// ----------------------------------------------------------------------

trigger OnNpcConversationResponse (string conversationId, obj_id player, string_id response)
{
	if (conversationId != "tatooine_tosche_sorna")
		return SCRIPT_CONTINUE;

	obj_id npc = self;

	int branchId = utils.getIntScriptVar (player, "conversation.tatooine_tosche_sorna.branchId");

	if (branchId == 1 && tatooine_tosche_sorna_handleBranch1 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 3 && tatooine_tosche_sorna_handleBranch3 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 5 && tatooine_tosche_sorna_handleBranch5 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 6 && tatooine_tosche_sorna_handleBranch6 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 8 && tatooine_tosche_sorna_handleBranch8 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 9 && tatooine_tosche_sorna_handleBranch9 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 10 && tatooine_tosche_sorna_handleBranch10 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	chat.chat (npc, "Error:  Fell through all branches and responses for OnNpcConversationResponse.");

	utils.removeScriptVar (player, "conversation.tatooine_tosche_sorna.branchId");

	return SCRIPT_CONTINUE;
}

// ======================================================================

